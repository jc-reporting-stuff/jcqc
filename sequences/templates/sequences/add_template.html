{% extends '_base.html' %}

{% block title %}Add Templates{% endblock title %}

{% load crispy_forms_tags %}
{% load static %}

{% block content %}

    <div style="width:90rem; margin: auto;">
        <p>This is <strong>Step 2 of 3.</strong></p>

        <form method="post" action="">
              {% csrf_token %}

            <div>

                <div style="width: 70rem; margin: auto;">

                    <h1 style="margin-left: 2rem;">Templates</h1>

                    {{ template_formset.management_form }}

                    <table class="oligo-view">
                        <tr>
                            <th>No.</th>
                            {% for field in template_formset.0 %}
                                {% if not forloop.last %}
                                    <th>{{ field.label }}{% if field.field.required%}<span class="asteriskField">*</span>{% endif %}</th>
                                {% endif %}
                            {% endfor %}
                        </tr>

                    {% for form in template_formset %}
                        <tr>
                            <th>{{ forloop.counter }}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            </th>
                            {% for field in form %}
                                {% if not forloop.last %}
                                    <td {% if field.errors %}class="error"{% endif %}>
                                        <label for="field.id_for_label" class="visually-hidden">{{field.label}}</label>{{ field }}
                                        {{ field.errors }}
                                        {% if field.help_text %}
                                            {{ field.help_text|safe }}
                                        {% endif %}
                                    </td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    </table>
                </div>
            
            </div>

            <div {% if primer_formset|length == 0 %}style="display: none"{% endif%}>

                <div style="width: 70rem; margin: auto;">
                    <h1 style="margin-left: 2rem;">Primers</h1>

                    {{ primer_formset.management_form }}
                    <table class="oligo-view">
                        <tr>
                            <th>No.</th>
                            {% for field in primer_formset.0 %}
                                {% if not forloop.last %}
                                    <th>{{ field.label }}{% if field.field.required%}<span class="asteriskField">*</span>{% endif %}</th>
                                {% endif %}
                            {% endfor %}
                        </tr>

                    {% for form in primer_formset %}
                        <tr>
                            <th>{{ forloop.counter }}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            </th>
                            {% for field in form %}
                                {% if not forloop.last %}
                                    <td>
                                        {{ field }}
                                    </td>
                                {% endif %}
                                {% if forloop.last %}
                                    {{ field }}
                                {% endif %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    </table>

                </div>
            
            </div>

            <input type="hidden" name="template-count" value="{{ template_count }}">
            <input type="hidden" name="primer-count" value="{{ primer_count }}">
            <input type="hidden" name="reaction-count" value="{{ reaction_count }}">
            <input type="hidden" name="account-id" value="{{ account_id }}">

            <div style="display: flex; width: 100%; justify-content: space-between;">
                <div>
                    <input type="submit" name="proceed-reactions" value="Proceed to reactions" class="button-primary">
                    <input type="reset" value="Clear all" class="button-primary">
                </div>
                <div>
                    View the list of 
                    <a href="#" onclick="openWindow('{% url 'sequencing:common_primers' %}')" style="cursor: pointer; text-decoration: underline;">Common Primers</a> 
                    <img src="{% static 'images/open-external-link.svg' %}" alt="popout window icon" class="inline-image">
                    provided by Lab Services.
                </div>
            </div>

            <div class="container half-width">
                <p><strong>Note:</strong>
                Template and primer names have to be clearly labelled on your tubes, bags and boxes or plates etc. They can be up to 16
                characters which only consist of letters, numbers, and <code>- _ ( ) +</code>. Spaces, quotation marks, asterisks and other symbols are not accepted.</p>
            </div>
                

        </form>

    </div>

    <script>
        const openWindow = (url) => {
            window.open(url, "CommonPrimers", "width=700,height=800,left=100,top=100");
        }
    </script>

{% endblock content %}